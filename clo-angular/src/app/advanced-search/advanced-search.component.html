
<div class="container" id="content">


    <!-- <div class="col-12"> -->
    <div>
      <H3>Advanced Search</H3>
    </div>
    <!-- </div> -->
    
    <form id="searchTerms">
      <div *ngFor='let query of queries; let i = index' class="search-box">
            <input type='string' size=80 [attr.id]="query[2][i]" name='ANDdocBody'/>
            <select [attr.id]="query[0][i]" (change)='changeDropDown($event)'>
              <option value='AND'>AND</option>
              <option value='OR-'>OR</option>
              <option value='NOT'>NOT</option>
          </select>
        </div> 
      </form>
      <div>
            <button (click)="addField()">Add Field</button>
            <button (click)="removeField()">Remove Field</button>
            <label for="terms"><INPUT type="submit" value="Search" (click)="startSearch()"></label><br/>
      </div>

      <div class="container-narrow-results">

        <div class="narrow-by-author">
          <p> <strong> Senders </strong> </p>
          <input type="checkbox" value='allAuthors' checked> <strong> Include All </strong> <br>
          <input type="checkbox" checked> Thomas Carlyle <br>
          <input type="checkbox" checked> Jane Welsh Carlyle <br>
        </div>

        <div class="narrow-by-recipient">
          <p class="recipient"> <strong> Recipients </strong> </p>
          <input type="checkbox" value='allRecipients' checked> <strong> Include All </strong> <br>
          <input type="search">
        </div>
        <div class="narrow-by-fields">
          <p class="fields"> <strong> Fields </strong> </p>
           <input type="checkbox" value='allFields' checked> <strong> Select/ Unselect All Fields </strong> <br>
           <input type="checkbox" value='docBody' checked> Letter Body <br>
           <input type="checkbox" value='sourceNote' checked> Source Notes <br>
           <input type="checkbox" value='footnotes' checked> Foot Notes <br>
           <input type="checkbox" value='imageCaptionAndMetadata' checked> Image Caption and Metadata
        </div>

        <div class="container-narrow-by-date-range">
          <p><strong> Get Results </strong></p>
          <div class="date-range-min">
              <label for="start-date"> dated between... </label>
              <input type="search" id="minDate" name="start-date">
          </div>
          <div class="date-range-max">
              <label for="end-date"> and... </label>
              <input type="search" id="maxDate" name="end-date"> 
          </div>
        </div>

      </div>

</div>

<!--
   <ul>
   
   <li>
        <input type="checkbox" [(ngModel)]="masterSelected" name="list_name" value="allFields" (change) = "checkUncheckAll()"/> <strong>Select/ Unselect All</strong>
     </li>
   </ul>
   <ul>
     li *ngFor="let item of checkList"> 
     <input type="checkbox" [(ngModel)]="item.checked" name="list_name" value="{{item.id}}" (change)="isAllSelected()"/>
       {{item.value}}
     </li> 
    </ul>
  </div>
   <code>{{checkedList}}</code>
-->

      <!-- {{#if volumes}}
          <hr/>
          {{#each volumes}}
              <div class="volume">
                  <div class="title"><span class="label">ID:</span><a href="https://clo.dev.cdhsc.org/volume/{{_id}}/{{letter.xml_id}}" target="_blank">{{letter.xml_id}}</a></div>
                  <div><span class="label">Letter Date:</span> {{letter.docDate}}</div>
                  <div><span class="label">Author:</span> {{letter.docAuthor}}</div>
                  <div><span class="label">Recipient:</span> {{letter.recipient}}</div>
              </div>
              <hr/>
          {{/each}}
      {{else}}
          <div>No data to display.</div>
      {{/if}}

       -->
 <div
  class="container-fluid"
  *ngIf="(searchResults | async) as results"
  id="content"
>
  <div class="row justify-content-start orange-border-bottom">
    <h4>Search Results for: <!-- "{{ searchQuery }}" --></h4>
    <ul style="list-style-type: none;">
      <li><h4>AND: {{ displayQuery[0] }}</h4></li>
      <li><h4>OR: {{ displayQuery[1] }}</h4></li>
      <li><h4>NOT: {{ displayQuery[2] }}</h4></li>
    </ul>
  </div>
  <ng-container *ngIf="results.data.length == 0">
    <div class="row justify-content-start pt-2">
      <span>No results found.</span>
    </div>
  </ng-container>
  <ng-container *ngIf="results.data.length > 0">
    <div class="row justify-content-between pt-2">
      <span
        >Displaying {{ start }} - {{ end }} of
        {{ results.data.length }} results.</span
      >
      <ngb-pagination
        [collectionSize]="results.data.length"
        [pageSize]="pageSize"
        [maxSize]="5"
        [rotate]="true"
        [(page)]="page"
        (pageChange)="setPage($event)"
      ></ngb-pagination>
    </div>
    <div
      class="row justify-content-between align-items-center p-2 result"
      *ngFor="let result of (results.data | sortBy:'dsc':results.data.score | slice: start - 1:end)"
    >
      <div class="col-8 p-0">
        <table cellpadding = "10">
          <tr>
            <td id="volResult" white-space: nowrap>
              <span>Volume: </span> {{ result._id }}
            </td>
            <td id="letterResult" white-space: nowrap>
              <span>Letter: </span>
              <a
                routerLink="/volume/{{ result._id }}/{{ result.letter.xml_id }}"
                [queryParams]="{ term: searchTerm }"
                routerLinkActive="active"
                target="_blank"
              >{{ result.letter.xml_id }}</a>
            </td>
            <td id="dateResult" white-space: nowrap>
              <span>Date: </span> {{ result.letter.docDate | date: "longDate" }}
            </td>
          </tr>
          <tr>
            <td id = "letterAuthor" white-space: nowrap>
              <span>Sender: </span> {{ result.letter.docAuthor.toUpperCase() }}
            </td>
            <td id = "letterRecipient">
              <span>Recipient: </span> {{ result.letter.recipient }}
            </td>
            <td id = "letterFootnotes">
              <span>Footnotes: </span>
              <a
              routerLink="/volume/{{ result._id }}/{{ result.letter.xml_id }}#footnoteCollapse"
              routerLinkActive="active">
              Link to Footnotes</a>
            </td>
          </tr>
        </table>
      </div>
      <div class="col-4 p-auto" id="resultText">
        <a
          data-toggle="collapse"
          href="#{{ result.letter.xml_id }}"
          aria-expanded="false"
          [attr.aria-controls]="result.letter.xml_id"
          style="text-decoration: none;"
        >
          <span>View Letter Content</span>
          <span style="color: #5c8b57 !important;">
            <fa-icon [icon]="faPlusSquare"></fa-icon>
          </span>
        </a>
      </div>
      <div class="col-12">
        <div class="collapse" id="{{ result.letter.xml_id }}">
          <div
            class="viewer-box"
            [innerHtml]="safeHTML(result.letter.docBody)"
          ></div>
        </div>
      </div>
    </div>
    <div class="row justify-content-center pt-2">
      <ngb-pagination
        [collectionSize]="results.data.length"
        [pageSize]="pageSize"
        [maxSize]="5"
        [rotate]="true"
        [(page)]="page"
        (pageChange)="setPage($event)"
      ></ngb-pagination>
    </div>
  </ng-container>
</div>
